{
    "type": "controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userClassName": "Contact",
        "stores": [
            "PeopleStore"
        ],
        "views": [
            "ContactDetail"
        ]
    },
    "id": "ExtBox1-ext-gen51189",
    "designerId": "4924b61f-714b-45ce-aa6a-944c48e631e4",
    "cn": [
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "onAddContactTap",
                "fn": "onAddContactTap",
                "implHandler": [
                    "",
                    "var form = this.getContactDetail();",
                    "form.reset(); //clear form",
                    "form.setRecord(null); //clear record from form",
                    "",
                    "//clears filter placed on Debt store",
                    "Ext.getStore('Debts').clearFilter();",
                    "",
                    "//hides buttons and debt data view on new contacts",
                    "form.down('#addDebt').hide();",
                    "form.down('dataview').hide();",
                    "this.getContactHeaderLabel().hide();",
                    "this.getLoanHistoryLabel().hide();",
                    "",
                    "//update url",
                    "this.getApplication().getHistory().add(new Ext.app.Action({",
                    "    url: '/Prey/add'",
                    "}), true);",
                    "",
                    "//set active item",
                    "Ext.Viewport.setActiveItem(this.getContactDetail());"
                ],
                "name": "tap",
                "designer|targetType": "Ext.Button",
                "designer|controlQuery": "#addContact"
            }
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "onSaveContactTap",
                "fn": "onSaveContactTap",
                "implHandler": [
                    "var form = this.getContactDetail(),",
                    "    record = form.getRecord(),",
                    "    values = form.getValues();",
                    "",
                    "if(record) { //if editing record",
                    "    record.set(values);",
                    "    record.save();",
                    "",
                    "} else { //if new record",
                    "",
                    "    record = Ext.create('Payback.model.Person',values);",
                    "",
                    "    Ext.getStore('People').add(record);",
                    "    Ext.getStore('People').sync();",
                    "}",
                    "",
                    "//update summary",
                    "this.getApplication().getController('Summary').updateSummary();",
                    "",
                    "//clear form",
                    "this.getContactDetail().reset();",
                    "",
                    "//refresh debt panel dataview with any new data",
                    "this.getMainView().getInnerItems()[1].down('dataview').refresh();",
                    "",
                    "//update url",
                    "this.getApplication().getHistory().add(new Ext.app.Action({",
                    "    url: '/Prey'",
                    "}), true);",
                    "",
                    "//set active item",
                    "Ext.Viewport.setActiveItem(0);"
                ],
                "name": "tap",
                "designer|targetType": "Ext.Button",
                "designer|controlQuery": "#saveContact"
            }
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "onCancelContactTap",
                "fn": "onCancelContactTap",
                "implHandler": [
                    "//delete form",
                    "this.getContactDetail().reset();",
                    "",
                    "//update url",
                    "this.getApplication().getHistory().add(new Ext.app.Action({",
                    "    url: '/Prey'",
                    "}), true);",
                    "",
                    "//set active item",
                    "Ext.Viewport.setActiveItem(0);"
                ],
                "name": "tap",
                "designer|targetType": "Ext.Button",
                "designer|controlQuery": "#cancelContact"
            }
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "onDataviewItemSwipe",
                "fn": "onDataviewItemSwipe",
                "implHandler": [
                    "var deleteButtons = dataview.query('button');",
                    "",
                    "//hide other delete buttons",
                    "for (var i=0; i < deleteButtons.length; i++) {",
                    "    deleteButtons[i].hide();",
                    "}",
                    "",
                    "var labels = Ext.select(target.getObservableId() +' .money-label');",
                    "labels.hide();",
                    "",
                    "//show item delete button",
                    "target.query('button')[0].show();",
                    "",
                    "//hides delete button if anywhere else is tapped",
                    "Ext.Viewport.element.on({tap:function(){",
                    "    target.query('button')[0].hide();",
                    "    labels.show();",
                    "}, single:true});"
                ],
                "name": "itemswipe",
                "designer|targetType": "Ext.dataview.DataView",
                "designer|controlQuery": "#myContactDataView"
            }
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "ContactDetail",
                "autoCreate": true,
                "ref": "ContactDetail",
                "selector": "ContactDetail",
                "xtype": "ContactDetail"
            }
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "onDataviewItemTap",
                "fn": "onDataviewItemTap",
                "implHandler": [
                    "var form = this.getContactDetail(),",
                    "    debtDataView = this.getMyDebtDataView();",
                    "",
                    "//set the record for the form",
                    "form.setRecord(record);",
                    "",
                    "//clears filter on store and sets a new one, this shows only the payments associated with the debt tapped",
                    "Ext.getStore('Debts').clearFilter();",
                    "Ext.getStore('Debts').filter(\"person_id\", record.get('id'));",
                    "",
                    "//refresh DataView",
                    "debtDataView.refresh();",
                    "",
                    "//update header",
                    "var header = this.getContactHeaderLabel();",
                    "header.setHtml(record.get('name'));",
                    "",
                    "//show items if hidden",
                    "debtDataView.show();",
                    "form.down('#addDebt').show();",
                    "this.getContactHeaderLabel().show();",
                    "this.getLoanHistoryLabel().show();",
                    "",
                    "//scroll to top",
                    "this.getContactDetail().getScrollable().getScroller().scrollToTop();",
                    "",
                    "//update url",
                    "this.getApplication().getHistory().add(new Ext.app.Action({",
                    "    url: '/Prey/'+(index+1)",
                    "}), true);",
                    "",
                    "//set active item",
                    "Ext.Viewport.setActiveItem(form);",
                    "",
                    "//set headerLabel font size, this needs to be set after the active item is set",
                    "var fontSize = 75;",
                    "var maxHeight = header.getHeight();",
                    "var maxWidth = Ext.Viewport.getWindowWidth()-20;",
                    "var textHeight;",
                    "var textWidth;",
                    "do {",
                    "    header.setStyle({'font-size': fontSize+'px'});",
                    "    textHeight = header.innerHtmlElement.getHeight();",
                    "    textWidth = header.innerHtmlElement.getWidth();",
                    "    fontSize = fontSize - 1;",
                    "} while ((textHeight > maxHeight || textWidth > maxWidth) && fontSize > 3);",
                    "header.setStyle({'padding-top': (100-textHeight)/2+'px'}); //center text"
                ],
                "name": "itemtap",
                "designer|targetType": "Ext.dataview.List",
                "designer|controlQuery": "#myContactDataView"
            }
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "myContactDataView",
                "ref": "myContactDataView",
                "selector": "#myContactDataView"
            }
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "myDebtDataView",
                "ref": "myDebtDataView",
                "selector": "#myDebtDataView"
            }
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "contactHeaderLabel",
                "ref": "contactHeaderLabel",
                "selector": "#contactHeaderLabel"
            }
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "loanHistoryLabel",
                "ref": "loanHistoryLabel",
                "selector": "#loanHistoryLabel"
            }
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "addContactButton",
                "ref": "addContactButton",
                "selector": "#addContact"
            }
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "MainView",
                "ref": "MainView",
                "selector": "MainView"
            }
        },
        {
            "type": "controllerroute",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "showContactDetail",
                "fn": "showContactDetail",
                "designer|params": [
                    "id"
                ],
                "implHandler": [
                    "",
                    "this.getMainView().setActiveItem(2);",
                    "",
                    "if(id==\"add\") {",
                    "    this.getAddContactButton().onTap();",
                    "} else {",
                    "",
                    "    id--;",
                    "    var dataView = this.getMyContactDataView();",
                    "    var dataItem = dataView.getItems().getAt(0).getInnerItems()[id];",
                    "",
                    "    if(dataItem) {",
                    "        this.onDataviewItemTap(dataView,id,null, dataItem.getRecord());  ",
                    "    }",
                    "}"
                ],
                "url": "/Prey/:id"
            }
        }
    ]
}